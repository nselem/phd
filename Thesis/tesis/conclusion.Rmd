---
output: pdf_document
---

# Perspectivas {.unnumbered}  
  \setcounter{chapter}{4}
	\setcounter{section}{0}
La promiscuidad ha redefinido cómo entendemos la función enzimática. Se ha transitado de considerar a todas las enzimas como altamente especialistas a entender que muchas de ellas pueden llevar a cabo más de una función metabólica. La promiscuidad parece parte del proceso evolutivo, provee material para que una posterior duplicación conlleve a la formación de nuevas familias enzimáticas. Este trabajo trató de entender la promiscuidad a diferentes escalas, incluyendo la diferenciación entre la existencia de familias promiscuas y la de ortólogos promiscuos miembros de dichas familias. Ahora bien, las enzimas suelen formar parte de clusters biosintéticos productores de metabolitos. También se generalizó el concepto de promiscuidad enzimática al de promiscuidad de una familia de BGC, es decir consideré ahora a una familia de BGC como una unidad de síntesis y me pregunté si podía ser promiscua en el sentido de que variantes del BGC, ya sea en la secuencia de los genes del core o en el contenido de genes accesorios, produjeran variantes del metabolito. Es decir se planteó la existencia de promiscuidad de producto en clusters biosintéticos. Con estos tres niveles en mente: enzima, familia enzimática, y cluster biosintético se desarrollaron Orthocore, EvoMining y CORASON, tres herramientas de genómica comparativa con el objetivo de entender mejor la promiscuidad enzimática en los niveles descritos.  

Con Orthocore pude resolver la filogenia del orden _Actinomycetales_ utilizando los genes del _core conservado_ y esto permitió entender que en dicho orden los patrones de especiación están relacionados con la pérdida y ganancia de promiscuidad de la familia PriA. Además pude utilizar Orthocore para encontrar genes marcadores de la especie _Clavibacter michiganensis_  que permiten diagnosticar la presencia de esta especie en plantas de tomate. Una lección de este capítulo es que el _core genome_ no sólo contiene genes del core metabólico, también puede contener genes productores de metabolitos especializados, y este contenido incrementará entre más cercanos sean filogenéticamente los organismos del linaje seleccionado. Una vez desarrollado Orthocore quedaban por investigar las familias enzimáticas contrarias al _core conservado_ es decir aquellas que sí tienen marcas de cambio en el número de copias de su gen codificante en al menos algunos organismos de un linaje genómico. El cambio ya podía ser observado porque aplicando Orthocore pueden organizarse filogenéticamente organismos de genomas cercanos, por ejemplo los del género _Streptomyces_.  
  
Así pues para estudiar no sólo los patrones de expansión sino también los de neofuncionalización, en particular los de reclutamiento a metabolismo especializado desarrolle a continuación la herramienta EvoMining. Las familias señaladas por EvoMining como expandidas y reclutadas son candidatos a ser familias promiscuas, y los miembros intermedios entre ortólogos dedicados a la función primaria y ortólogos dedicados al metabolismo especializado son candidatos, aunque no exclusivos a ser miembros promiscuos de la familia. En esta sección entendí que las familias del _shell genome_ también tienen reclutamientos y expansiones, que este comportamiento no es exclusivo de ciertas familias del _core genome_. Después de esta observación queda pendiente realizar un estudio con todas las enzimas del _shell genome_ de un linaje para entender cómo son las tendencias generales por ejemplo por subsistema metabólico. Con EvoMining desarrollé dos ejemplos donde en efecto enzimas de metabolismo conservado ( _shell o core_ ) mostraban miembros reclutados en el metabolismo especializado. El primer ejemplo fueron familias del cluster de síntesis de escitonemina en Cyanobacteria. A la fecha este BGC no ha sido predicho por otros métodos bioinformáticos ya que está compuesto exclusivamente por familias que provienen de expansiones del metabolismo primario y no posee ninguna enzima catalogada como exclusivamente dedicada al metabolismo especializado. El segundo ejemplo es la familia TauD común en los BGC de Rimodamide y Detoxin. Este ejemplo tiene expansiones y reclutamientos tanto en Actinobacteria como en _Pseudomonas_. El estudio de las variantes de estos BGC fue resuelto con el desarrollo de CORASON, una herramienta especializada en identificar variantes de contextos genómicos.

Así pues desarrollé CORASON para ver el continuo de variantes de un BGC en un linaje genómico. Con esta herramienta, al observar la amplia variación en cuanto a presencia y ausencia de genes accesorios en Actinobacteria de la familia rimosamide-detoxin BGC pensé que esta familia de clusters debía ser promiscua. Además esta observación estaba soportada por el hecho de que rimosamide y detoxin compartían un core molecular común posiblemente relacionado con el core génico de la familia, pero tenían las moléculas se diferenciaban en ciertos ornamentos, probablemente debidos a los genes accesorios de la familia. Propuse pues que esta familia de BGC es promiscua, y que al seleccionar genomas de diversos clados del árbol del BGC se deberían encontrar nuevas variantes moleculares. Exitosamente,nuestro grupo de colaboradores pudo caracterizar dos nuevas variantes al core molecular rimosamide - detoxin comprobando así la amplia promiscuidad de esta familia.  

   En este punto quedó pendiente tener una medida de la diversidad de los clusters, pienso que así como un pangenoma de un linaje se puede clasificar como abierto o cerrado según pueda o no saturarse el número de familias génicas al agregar más genomas del linaje, este concepto podemos generalizarlo a una medida de la variabilidad génica del _pancluster_. Entre más familias de genes distintos aparezcan en la vecindad del core del cluster mayor será la apertura de esta familia de BGC. Custers muy conservados con poca variación en los genes accesorios tendrán un "pancluster" cerrado, como ejemplo de este caso está el operón de histidina en ciertas clases de Archaea. Las mismas medidas de apertura de pangenoma pueden aplicarse al _pancluster_, entre más abierto sea un cluster es posible que presente mayor promiscuidad por producto por concepto de variación en sus genes accesorios. Otra posibilidad para que un BGC sea promiscuo a pesar de tener muy poca variación en los genes accesorios es que alguna de las enzimas conservadas sea promiscua.  
   
Finalmente, estudiamos diversos aspectos de la familia PriA, una familia promiscua en Actinobacteria que en ese phylum no pasó por un proceso de duplicación reciente y por tanto no sería sugerida por EvoMining como una familia promiscua. En este último capítulo vimos el ejemplo de HisF como resultado de una expansión de HisA y su posterior reclutamiento reclutamiento en el cluster de síntesis de histidna. Con ello EvoMining nos revelaba que el destino metabólico de una nueva función no tiene que permanecer en el metabolismo especializado, ese destino también puede ser fijado en metabolismo conservado. Además también en Actinobacteria encontramos una PriA que parece catalizar una reacción de un sustrato parecido a sus sustratos nativos en un cluster de síntesis de la pntostatina. Esta secuencia es similar a la de _S. coelicolor_ por lo que posiblemente hemos dado con una nueva ganancia de promiscuidad de PriA que podemos probar en los critales de proteína ya producidos. Con CORASON vimos que a pesar de la nueva disponibilidad de genomas, los patrones del operón his observados en los primeros estudios de Archaea se mantienen. Después estudiamos PriA a nivel de aminoácidos, montamos un método para aprovechar el registro evolutivo para generar estructuras tridimensionales de PriA. Quedó pendiente generar estructuras para todos las secuencias de la familia PriA para buscar diferencias que correlacionen con las subfamilias. Con las tres herramientas EvoMining, CORASON y EVcouplings seleccioné homólogos interesantes de PriA, ya sea porque tienen dos copias enn su genoma de origen, porque poseen contextos genómicos atípicos o bien porque tienen variantes en los aminoácidos catalíticos. Queda pendiente la caracterización bioquímica de esta selección.  

Además una mezcla entre Orthocore y EvoMining me permitió descubrir que PriA no sólo no está expandida en Actinobacteria sino que ni siquiera es parte del _core genome_. Debido a la ausencia tanto de PriA como del resto de los genes de la ruta ciertos grupos de Actinobacteria parecen ser auxótrofos para histidina. Entre ellos están _Atopobium_, _Molibuncus_ y _Tropheryma_, así como ciertos _Bifidobacterium_ y _Actinomyces_ e incluso algunos _Corynebacterium_. Los géneros _Molibuncus_ y _Tropheryma_ carecen de la mayoría de genes de síntesis tanto de histidina como de triptofano. Los _Corynebacterium_ en cambio sí poseen genes de síntesis de triptofano, lo que sugiere que podría estar subfuncionalizándose reteniendo sólo la función TrpF. Esto es una novedad para _Corynebacterium_ donde ya se conoce la ocurrencia de homólogos pertenecientes a subHisA pero no se ha detectado hasta ahora la presencia de la familia subtrpF. Además en _Saccharomonospora halophila_ , _Streptomyces sp._ NRRL B-2790, _Streptomyces sp._ NRRL S-1777, _Streptomyces sp. NRRL WC-3549_ y _Streptomyces sp._ NRRL WC-3704 tampoco fue encontrada PriA y sí genes de los operones de histidina y triptofano. En los últimos tres se localiza una doble copia de HisF. Esto puede deberse tanto a problemas técnicos de secuenciación como a una verdadera observación biológica donde se sugiere que HisF puede ser multifuncional rescatando al menos la función de HisA y posiblemente la de TrpF.  

Posteriormente en PriA parece que detecté una nueva interacción con el sustrato dGTP, aunque estos experimentos no son conclusivos ya que no fueron replicados. Finalmente una pregunta obligada es si así como la promiscuidad varía entre ortólogos de una familia, también varía entre cada una de las moléculas provenientes del mismo gen del mismo organismos. Es decir si la promiscuidad es una propiedad de cada molécula, o si es una propiedad de una población de moléculas, donde unas se dedican a un sustrato y otras a la catálisis de otro. Esta pregunta se debe abordar con una técnica de medición molécula por molécula. Di un primer paso intentando medir la actividad de una población de PriA simultáneamente tanto sobre ProFAR como sobre PRA. 

Considero que con los desarrollos pude abordar la búsqueda de familias de enzimas candidatas a tener cambios en promiscuidad acotandome a aquellas cuyo cambio de estado era debido a un proceso de neofuncionalización que dejó como huella un cambio en el número de copias respecto a organismos cercanos. CORASON como herramienta de vecindad genómica ayudó a identificar cambios en las vecindades en el sentido de que no sólo la secuencia de la copia secundaria de la enzima era divergente de la copia central, sino también la vecindad genómica de la nueva copia era divergente de la vecindad genómica de la copia primaria. Estas herramientas, además de tratar la promiscuidad enzimática me ayudaron también a minar el pangenoma de linajes genómicos en busca de nueva química en clusters biosintéticos de metabolitos secundarios.  

# Protocolos
  \setcounter{chapter}{4}
	\setcounter{section}{1}
                          
## Protocolos para usar Orthocore, myRAST, fastOrtho, Clavigenomics, y BPGA  
Anotación genómica con el docker myRAST  

Esta es una distribución de myRAST en un contenedor de docker. Para usarla se necesita una cuenta del anotador genómico RAST. el docker myRAST permite hacer anotación genómica y funcional masiva mediante el uso de la terminal en el anotador RAST. Después de anotar los resultados pueden descargarse y procesarse en una terminal  

Descargar myrast docker distribution   

Una vez con docker instalado en la computadora, se hace pull al docker myrast.  

docker pull nselem/myrast  
Abrir myRast en la terminal  

docker run -i -t -v $(pwd):/home nselem/myrast /bin/bash  

Usar myRast  

-Ejemplo subir un archivo fasta  

svr_submit_RAST_job -user <user> -passwd <pass> -fasta <file> -domain Bacteria -bioname "Organism name" -genetic_code 11 -gene_caller rast  

-Para bajar un archivo de anotación genómica funcional:  

svr_retrieve_RAST_job <user> <password> <jobId> table_txt > $ID.txt  

Una lista completa de archivos puede ser procesada usando bash. Por ejemplo para bajar una lista de archivos de RAST se deben guardar los identificadores de RAST en una columna de un archivo, (Rast_ID en este ejemplo) y usar un while para obtenerlos:  

En este caso la variable “line” contendrá el identificador RAST Id, y cada archivo fasta de aminácidos podrá ser obtenido mediante su identificador de RASTy será guardado en el archivo “$line.faa”  

cut -f1 Rast_ID | while read line; do svr_retrieve_RAST_job <user> <password> $line amino_acid > $line.faa ; done  
Formatos de RAST para descargar archivos   

Puedes cambiar el formato table_txt por el que tú necesites.  

Table: Formatos de descarga disponibles en myRAST \label{tab:myrast}
  
|Atributo        |Descripción                                             |  
|----------------|--------------------------------------------------------|  
|genbank         |GenBank (con funciones y enriquecimiento de SEED)       |  
|genbank_stripped|Genbank con EC-numbers removidos de las funciones|  
|embl            |EMBL (con funciones y enriquecimiento de SEED)  |  
|embl_stripped   |EMBL con EC-numbers removidos de las funciones|  
|gff3            |GFF3|  
|gff3_stripped |GFF3 con EC-numbers removidos de las funciones|  
|gtf |GTF|  
|gtf_stripped|  GTF con EC-numbers removidos de las funciones|  
|rast_tarball | Archivo comprimido (gzipped) con todo el directorio de las anotaciones de RAST sobre el genoma|  
|nucleic_acid|  Fasta de DNA de genes|  
|amino_acid  |Fasta de DNA de aminoácidos|  
|table_txt|Gene data in tab-separated format|   
|table_xls|Preserve the original gene calls and use RAST|  

  Referencia `r ref("myrast", type = "table")`.  
  
## Orthocore  

El umbral de e-value de Orthocore es por default 1e-6. Todas las secuencias son alineadas usando MUSCLE v3.8.31 con los parámetros default y curadas utilizando Gblocks con 5 posiciones como longitud mínima del  bloque, 10 como máximo número de posiciones contiguas no conservadas y sólo considerando posiciones con gaps menores que el 50% de las secuencias en el alineamiento final. Después de esta curación las secuencias son concatenadas en una matriz final

\appendix

# Figuras suplementarias de EvoMining  
```{r DataTabla42, results = "asis",message=FALSE,echo=FALSE}
label(path = "Anexos/Tabla42.pdf", 
      caption = "Expansiones de las 42 enzimas en los cuatro linajes genómicos",
      label = "DataTabla42", 
    scale=".8",
      cap.size = "footnotesize",
      alt.cap="Función y número de copias promedio en los cuatro linajes taxonómicos de las enzimas de las 42 familias de la base de datos de enzimas de EvoMining",
      type = "figure")
```

```{r HeatMapsytonemin, results = "asis",message=FALSE,echo=FALSE}
label(path = "Anexos/HeatMapsytonemin.pdf", 
      caption = "HeatMap de EvoMining de enzimas relacionadas a escytonemina en el linaje Cyanobacteria",
      label = "HeatMapsytonemin", 
    scale=".8",
      cap.size = "footnotesize",
      type = "figure")
```


```{r GDHJunto, results = "asis",message=FALSE,echo=FALSE}
label(path = "Anexos/GDHJunto.png", 
      caption = "Árbol de GDH en Actinobacteria, Cyanobacteria, $Pseudomonas$ y Archaea donde se muestra la transferencia horizontal ocurrida en esta familia.",
      label = "GDHJunto", 
    scale=".8",
      cap.size = "footnotesize",
      type = "figure")
```

```{r GDHFactor, results = "asis",message=FALSE,echo=FALSE}
label(path = "Anexos/GDHFactor.pdf", 
      caption = "Árbol de GDH en los cuatro linajes donde se muestra la alternancia en el uso de cofactores.",
      label = "GDHFactor", 
    scale=".8",
      cap.size = "footnotesize",
      type = "figure")
```

## Figuras suplementarias de CORASON  

### El contexto de una rama divergente de _tauD_ está conservado en Pseudomonas  

En Pseudomonas el gen _tauD_ tiene un contexto que incluye genes de metabolismo especializado. Variantes de este contexto están distribuidas en varios organismos. Parecen ser diferentes de los rimosamides y detoxins reportados en Actinobacteria.  


```{r PseudomonasTauD, results = "asis",message=FALSE,echo=FALSE}
label(path = "chapter3/PseudomonasTauD.pdf", 
      caption = "EvoMining Algorithm",
      label = "PseudomonasTauD",     
      cap.size = "footnotesize",
      alt.cap="En Pseudomonas el gen $tauD$ tiene un contexto que incluye genes de metabolismo especializado. Variantes de este contexto están distribuidas en varios organismos. En particular  ",  scale=".9",
      type = "figure")
```
   


# El tercer apéndice, comandos de Docker y Git y R  
## Docker  
-Create a new repository  
`docker build . -t evomining`  
`docker push nselemevomining`

Restart docker and free all ports  
`sudo service docker restart`   

list containers  
`docker ps -a`  

ssh or bash into a running docker container  
`sudo docker exec -i -t romantic_brahmagupta /bin/bash`
`docker exec -it <mycontainer> bash`  

Stop all containers  
`docker rm $(docker ps -a -q)`  

Remove stopped containers   
`docker rm $(docker ps -q -f status=exited)`

Remove all images  
`docker rmi $(docker images -q)`  

uninstall docker from ubuntu (Fresh start)   
`sudo apt-get purge docker-engine`   
`sudo apt-get autoremove --purge docker-engine`    
`rm -rf /var/lib/docker`   # This deletes all images, containers, and volumes

Run Evomining container using nselem/newevomining image  
` docker run -i -t -v /home/nelly/GIT/EvoMining/:/var/www/html/EvoMining/exchange -p 80:80 nselem/newevomining /bin/bash`
  
Start evomining inside this container   
`perl startevomining`  

Vizualice a tree  
`http://10.10.100.234/EvoMining/cgi-bin/color_tree.pl?9&&/var/www/html/EvoMining/exchange/CyanosBBH_MiBIG_DB.faa_CYANOS`
file 9.new must be on folder volume CyanosBBH_MiBIG_DB.faa_CYANOS  

Find a perl module  
`perl -MList::Util -e'print $_ . " => " . $INC{$_} . "\n" for keys %INC'`
EvoMining notes  
Gblocks only runs inside folder /var/www/html/EvoMining  

## Git  
`git add --all`  
`git commit -m "Some message"`   
`git push -u origin master`   
`git clone `  

## Connect GitHub and DockerHub
automated builds
The Dockerfile is available to anyone with access to your Docker Hub repository.
Your repository is kept up-to-date with code changes automatically.

# Apendice 3 Dinámica molecular vs datos experimentales  

En las tablas  `r ref("PriAPRA", type = "table")` , `r ref("PriAProFAR", type = "table")` se muestra a detalle la comparación entre las dinámicas moleculares de PriA respecto a PRA y ProFAR. Estos datos sugirieron que GTp es el sustrato con mayor afinidad y por ello en la última sección se avanzó en la realización de cinéticas enzimáticas con GTP.

Table: Actividad de PriA en S3 PRA \label{tab:PriAPRA}     

$$ 
\resizebox{\columnwidth}{!}{%
\begin{tabular}{ l c r l l l l l}
\hline \\ [-1.5ex]
organism  &Family & $K_M    $     & $k_{cat}$        & $\frac{k_{cat}}{K_M}$ &Pre MD & Pos MD & Reference  \\ [1ex]
\hline \\ [-1.5ex]
Afer	    &HisA   & $1.1\pm0.2$   &$	0.05\pm0.001	$& 0.045	              &-10.1	&-12.3   	 &Noda-García L et al 2015\\ [1ex]
Ecoli	    &HisA   &$	1.6	        $&$ 	  	4.9       $&3.1                   &-9.9   &-16	     &Henn-Sax et al. (2002)\\ [1ex]
Sent	    &HisA   &$	17.0 \pm0.1 $&$	7.8 \pm 2.4	  $&$4.5 × 10^5          $&-10.3  &-20.1     &Söderholm A et al (2015)\\ [1ex]
Aaur	    &PriB   &$	2.1 \pm 0.5 $& $	1.8 \pm 0.2 	$&0.9                   &-7.4   &   		   &verduzco-castro 2016\\ [1ex]
Sipo	    &PriB   &$	3.8\pm0.2	  $&$0.82\pm0.02	    $&0.21	                &-8.2	  &-14.7	   &verduzco-castro 2016\\ [1ex]
SspC	    &PriB   &$	11.4\pm3.4	$&$2.53\pm0.74	    $&0.22                  &	-8.5	&-12.7	   &verduzco-castro 2016\\ [1ex]
SMg1	    &PriB   &$	13.2\pm3.4	$&$0.92\pm0.19	    $&0.069	                &-8	    &-15.2     &verduzco-castro 2016\\ [1ex]
Ssvi	    &PriB   &$	3.9\pm0.89	$&$0.69\pm0.04	    $&0.18	                &-8.2	  &-16.7     &verduzco-castro 2016\\ [1ex]
Scoe	    &PriA   &$	3.6\pm0.7	  $&$ 1.3\pm0.2	    $  &0.4	                  &-8.4	  &-15	     &Noda-García et al (2010)\\ [1ex]
Sglob	    &PriA   & $4.2\pm0.8	 $ & $0.74\pm0.03	 $   &0.18	                &-9.2	  &-16.7	   &verduzco-castro\\ [1ex]
Mtub 2Y85	&priA   &$	19	0.23	  $&$0.012	-9.7		  $&                      &       &          &Due et al 2011\\ [1ex]
Mtub 3ZS4	&priA   &$	?			      $&$-9.9		        $&                      &       &          &Due et al 2011 (To be published)\\ [1ex]
Auro	    &priA   &$	4.0 \pm 0.9	$&$0.2 \pm 0.03	  $&0.04	                &-9.2		&          &Vazquez-Juarez (2016)\\ [1ex]
Cjei	    &PriA   &$	2.3 \pm 0.2	$&$0.9 \pm 0.08	  $&0.39	                &-8.5		&          &Noda-García et al (2013)\\ [1ex]
Cdip	    &subHisA&$	4.4 \pm 0.5	$&$2.6 \pm 0.3	    $&0.59	                &-9.2		&          &Noda-García et al (2013)\\ [1ex]
SMg1 TrpF	&TrpF3  &	-	             &-	               &-	                    &-6.9	  &-9.6	     &verduzco-castro 2016\\ [1ex]
Jden	    &TrpF3  &	-	             &-	               &-	       -7.2	        &-9.4	  &$16.8\pm3.3$&	Verduzco-Castro E et al  2016\\ [1ex]
Acar      &SubHisA&	0.02					 &                 &	                    &       &          &			\\ [1ex]
Aodo	    &SubTrpF&		-	           &-	               &-                     &       &          &\\ [1ex]
\hline
\end{tabular}}
\label{tab:PriAPRA}  
%}
$$ 
  
\clearpage  
La siguiente tabla es análoga a la anterior pero con el sustrato ProFAR  
  
Table: Actividad de PriA en S7 ProFAR \label{tab:PriAProFAR}      

$$ 
\resizebox{\columnwidth}{!}{%
\centering 
\begin{tabular}{ l c r l l l l l}
\hline \\ [-1.5ex]
organism  &Family  &  $K_M$ & $k_{cat}$& $\frac{k{cat}}{K_M}$ &Pre MD &Pos MD &Reference  \\ [1ex]
\hline \\ [-1.5ex]
Afer      &HisA    &-            &-                &-          &-9.2    &-9        &Noda-García L et al. (2015)   \\ [1ex]
Ecoli     &HisA    &-            &-                &-          &-9      &-11.1     &Henn-Sax et al. (2002)\\ [1ex]
Sent      &HisA    &-            & -               &-          &-9.6    &-10.2     &Söderholm A et al (2015)\\ [1ex]
Aaur      &PriB    &$26.3\pm6.3$ & $0.37\pm 0.09$  & 0.014     &-7.1    &-         &verduzco-castro 2016\\ [1ex]
Sipo      &PriB    &$60.8\pm1.1$ &$8.25\pm0.4 $    &0.14       &-8      &-8.5      &verduzco-castro 2016 \\ [1ex]
SspC      &PriB    &$149.9\pm29$ &$1.4\pm0.12 $    &0.009      &-8.5    &-10.8     &verduzco-castro 2016\\ [1ex]
SMg1      &PriB    &$129.6\pm34$ &$0.29\pm0.04$    &0.0022     &-7.5    &-11       &verduzco-castro 2016\\ [1ex]
Ssvi      &PriB    &$24.5\pm4.0$ &$1.6\pm0.29 $    &0.067      &-8      &-9.7      &verduzco-castro 2016 \\ [1ex]
Scoe      &PriA    &$5.0\pm0.08$ &$3.4\pm0.09  $   &0.7        &-8      &-9.4      &Noda-García et al (2010)   \\ [1ex]
Sglob     &PriA    &$11\pm1.0$  &$3.8\pm0.2  $     &0.34       &-8.7    &-9.4      &verduzco-castro 2016  \\ [1ex]
Mtub2Y85  &priA    &21         &3.6         &0.17       &-8.6    &          &Due et al 2011                        \\ [1ex] 
Mtub3ZS4  &priA    &           &            &           &-9.3    &          &Due et al 2011 (To be published)      \\ [1ex] 
Auro      &priA    &$23 \pm 6.5 $  &$0.5\pm0.05 $&0.02       &-9.3    &          &Vazquez-Juarez (2016)                 \\ [1ex] 
Cjei      &PriA    &$5.1 \pm1.0$  &$1.6 \pm 0.16 $&0.31       &-9      &          &Noda-García et al (2013)              \\ [1ex]
Cdip      &subHisA &-          &-           &-          &-8.8    &          &Noda-García et al (2013)              \\ [1ex]
SMg1 TrpF &TrpF3   &$8.4\pm1.7$    &$10.5\pm2.4$    &1.25       &-7.6    &-9        &verduzco-castro     \\ [1ex] 
Jden      &TrpF3   &$16.8\pm3.3$   &$27\pm1.6$      &1.6        &-7.6    &-7.7      &verduzco-castro     \\ [1ex] 
Acar      &SubHisA &Na         &Na          &0.02       &Na      &Na        &Na                                    \\ [1ex] 
Aodo      &SubTrpF &-          &-           &-          &-       &Na        &Na                                    \\ [1ex]
\hline
\end{tabular}}
\label{tab:PriAProFAR}    
%}  
$$



```{r sessionInfo,echo=FALSE, eval=FALSE,results='hide',message=FALSE,warning=FALSE}

#vignette(package="genstats")
#vignette("01_06_three-tables")

# phenoData:
tmp <- read.csv("chapter4/ProteinData", row.names = 1,header=TRUE,sep="\t")
pdata <- AnnotatedDataFrame(tmp)

# featureData:
tmp <- read.csv("chapter4/Substrate.data", row.names = 1,sep="\t")
fdata <- AnnotatedDataFrame(tmp)

# expression data:
tmp <- read.table("chapter4/EnsymeVsSubstrate.data",row.names = 1,header=TRUE,sep="\t")
m <- as.matrix(tmp)
#dim(m)
#class(m)
#colnames(m)
#rownames(m)
## Names should not start on numbers never
## create ExpressionSet object:
#eset <- new("ExpressionSet", exprs = m, phenoData = pdata, featureData = fdata)
```
<!-- to change R colors to my wn perl heatplot
mrBayes PriAjulian.nxs on mazorca goes to PriAjulian.con.tre
PriAjulian.con.tre was open with figtree and saved as SVG
To get coordinates: `coordtree.pl PriAjulian.SVG`  
Heatplot color are from ggplot R
mydata.xls lo guardoen mydata.cvs
perl read_mydata.pl mydata.cvs >Heat.colors
manually edit Heat.colors by adding headers enzymas y substrates
perl heatFromRGB.pl HeatColor YPriAJulian
Hice el heatplot en SVG con el script   
-->
  
  <!--
  Observaciones Mauricio  
Figura/tabla de funcionalidad de familias  
Separar datos experimentales por funcion y poner  pie de tabla  
en la figura colorear por funcion, solo 3 grupos  

Poner Figura suplementaria PRA PROFAR presencia ausencia trpF


- falta el pie de figura
Substrate docking over enzymes from extended PriA families. Substrates 1-20  

- poner unidades en la escala  

- intenta aumentar el contraste de color entre el valor mínimo y máximo de la escala  
invertir colores 

- repite las etiquetas de los sutratos abajo del heatmap  
Pendiende  

JOHAN /MAURICIo
Poner que No es todo el univrso de sustratos sino solo el de KEGG

Hacer mejor curvas con los valores, en lugar del heatplot

Hacer docking con otras plantillas (2VEP vs 2X30)

Analisis cuantitativo de los datos.  

PACO
Tipo de seleccion en todo PriA  

-->
  <!---
  ```{r johan}
docking <- read.csv("chapter4/SmallHeat.data", header=TRUE, sep="\t")

for (i in 2:21)
{plot(density(docking[,i],na.rm=T)); rug(docking[,i]);browser()}
plot(cor(docking[-c(5,12,13,38,51),-1]))
## Leer sobre la incertidumbre del 2 y explicarla  
## Y leer el paper de Julian y el de mauricio sobre reportes de docking

```
--->
  
```{r load_data_docking,results='hide',echo=FALSE,message=FALSE,echo=FALSE,warning=FALSE}
docking <- read.csv("chapter4/SmallHeat.data", header=TRUE, sep="\t")
EnzymeOrder=factor(docking$Enzima,levels=unique(docking$Enzima))
docking.m <- melt(docking,id = "Enzima")
docking.m <- ddply(docking.m, .(variable), transform,rescale = rescale(value))
docking.m$Enzima <- factor(docking.m$Enzima, levels = rev(docking.m$Enzima[order(EnzymeOrder)]))

##on colors
colorHeatPlot<-ggplot(docking.m, aes(x=variable, y=Enzima)) + labs(x = "Substrates", y = "Enzymes",text = element_text(size=12))+ geom_raster(aes(fill=value))+theme_bw()+theme(plot.title = element_text(size = 14, face = "bold"), text = element_text(size = 12), axis.title = element_text(face="bold"), axis.text.x=element_text(angle = 90,size = 6))+ scale_fill_gradientn(colours = hm.palette(100),na.value = "gray")
ggsave("chapter4/colorHeatPlot.pdf", plot = colorHeatPlot,height = 36, width = 24)

gcolor <- ggplot_build(colorHeatPlot)
#gcolor$data[[1]]["fill"]
#gcolor$data[[1]]
write.xlsx(gcolor$data[[1]], "chapter4/mydataColor.xlsx")

```

```{r heatonPDF, eval=FALSE,results='hide',  echo=FALSE,message=FALSE,echo=FALSE,warning=FALSE}
ggplot(docking.m, aes(x=variable, y=Enzima)) + labs(x = "Substrates", y = "Enzymes",text = element_text(size=12))+ scale_fill_gradientn(colours = hm.palette(100),na.value = "gray")+theme_bw()+theme(plot.title = element_text(size = 14, face = "bold"), text = element_text(size = 12), axis.title = element_text(face="bold"), axis.text.x=element_text(angle = 90,size = 6))
```

```{r substrateBox, eval=FALSE, message=FALSE,echo=FALSE,warning=FALSE}
## boxplot de los sustratos
ggplot(docking.m, aes(x=variable, y=value)) + labs(x = "Substrates", y = "Affinity",text = element_text(size=12)) + geom_boxplot()+theme_bw()+theme(plot.title = element_text(size = 14, face = "bold"), text = element_text(size = 12), axis.title = element_text(face="bold"), axis.text.x=element_text(angle = 90,size = 6), legend.position = "bottom")

```

\clearpage  

```{r docking_table_out, results = "asis", message=FALSE,echo=FALSE,warning=FALSE}
docking <- read.csv("chapter4/SmallHeat.data", header=TRUE, sep="\t")
kable(docking,  
      caption = "Enzymes docking \\label{tab:docking}",
      caption.short = "Enzymes docking ") %>%  kable_styling(latex_options="scale_down")
```
<!--
  \caption[Table caption text]{Table taken from \cite[p.10]{verduzco-castro_co-occurrence_2016} }

\label{table:name}

-->

\clearpage  

# El cuarto Apéndice, Protocolos experimentales utilizados en el estudio de PriA  
```{r materials, child = 'chapter4/materiales.Rmd'}
```

```{r ProteinPurification, child = 'chapter4/ProteinaPurificacion.Rmd'}
```

```{r ProteinQuantification, child = 'chapter4/ProteinQuantification.Rmd'}
```

